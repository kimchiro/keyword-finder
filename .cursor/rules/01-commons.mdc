---
description: Naver Search Keywords Collector (자동완성 / 함께 많이 찾는 / {searchData} 인기주제 + DB 연동)
globs: 
alwaysApply: false
---

## 01-프로젝트 개요
- 네이버 통합검색 페이지에서 **3가지 데이터 모듈**을 안정적으로 수집한다:
  1) 자동완성(연관검색어)
  2) 함께 많이 찾는
  3) {searchData} 인기주제  ← 섹션 타이틀에 “인기주제”가 포함된 블록 (앞에 붙는 컨텍스트 예: “맛집 인기주제”는 무시하고 "인기주제"만 핵심 키워드로 탐지)
- 수집된 데이터는 **JSON 파일로 저장**하고, 동시에 **DB(MySQL/Postgres)에 insert**한다.
- n8n 워크플로우와 Playwright(Node.js) 코드로 구성하며, Cron 스케줄링 가능해야 한다.

---

## 02-DB 스키마 설계
랭킹 추세 분석을 지원하기 위해 `query`와 `created_at`을 반드시 포함한다.

```sql
CREATE TABLE naver_keywords (
  id SERIAL PRIMARY KEY,
  query VARCHAR(100) NOT NULL,           -- 기준 검색어 (예: '맛집')
  keyword_type VARCHAR(50) NOT NULL,     -- autosuggest / togetherSearched / hotTopics
  text VARCHAR(255) NOT NULL,            -- 키워드 텍스트
  href TEXT,                             -- 관련 링크 (없으면 NULL)
  imageAlt TEXT,                         -- 이미지 대체 텍스트 (인기주제에서 사용)
  rank INT NOT NULL,                     -- 섹션 내 순위
  grp INT DEFAULT 1,                     -- 페이지/슬라이드 그룹 번호
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

03-Playwright(Node.js) 워크플로우 요구사항

입력값

query: 검색어 (예: "맛집")

headless: true/false

maxPagesPerModule: 3 (페이지네이션/슬라이드 한계)

waitTimeoutMs: 5000

sleepMinMs/sleepMaxMs: 200 / 600 (랜덤 딜레이)

자동완성 (연관검색어)

검색창 포커스 → query 입력 → div[role=listbox] li 등장 대기

li 텍스트 추출 → rank 부여

함께 많이 찾는

섹션 타이틀 "함께 많이 찾는" 탐지

.//a | .//button 텍스트/링크 수집

페이지 점/버튼 클릭 반복 (maxPagesPerModule 회까지)

페이지 번호는 grp 컬럼으로 저장

{searchData} 인기주제

타이틀 "인기주제" 포함 섹션 탐지

칩/버블의 텍스트, 링크, 이미지 alt 수집

캐러셀 “다음” 버튼 반복 (maxPagesPerModule 회까지)

그룹 번호는 grp 컬럼에 저장

정제/중복 제거

trim → 공백 정규화 → 2자 미만/특수문자-only 제외

text 기준 중복 제거

rank와 group은 새로 부여

출력

JSON 파일: output/naver_keywords_{query}_{YYYYMMDD_HHmm}.json

동시에 DB에 insert

04-n8n 워크플로우 설계

Execute Command: Playwright 스크립트 실행 → JSON 파일 생성

Read Binary File: JSON 파일 읽기

Move Binary Data → JSON: JSON 데이터 변환

Function: JSON 배열 → DB insert용 row 변환

Database Insert (MySQL/Postgres): naver_keywords 테이블에 저장

(옵션) Spreadsheet/Google Sheets: 결과 백업

Cron Trigger: 스케줄링 (매일/매주 등)

05-검수 기준

autosuggest: 최소 6개

함께 많이 찾는: 최소 6개 (1~2 페이지 수집)

인기주제: 최소 8개 (1~2 슬라이드 수집)

중복 0건, 공백 정리 완료

created_at은 모든 row에 동일하게 찍혀서 “한 번의 수집 세트”임을 보장

전체 실행시간: 6~12초 내

06-법/정책 주의

네이버 robots/약관 준수

로그인/개인정보/광고 클릭 금지

과도한 요청 빈도 제한