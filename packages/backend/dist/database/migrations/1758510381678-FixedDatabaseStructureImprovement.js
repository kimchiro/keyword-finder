"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FixedDatabaseStructureImprovement1758510381678 = void 0;
class FixedDatabaseStructureImprovement1758510381678 {
    constructor() {
        this.name = 'FixedDatabaseStructureImprovement1758510381678';
    }
    async up(queryRunner) {
        await queryRunner.query(`CREATE TABLE \`keywords\` (\`id\` int NOT NULL AUTO_INCREMENT, \`keyword\` varchar(255) NOT NULL, \`status\` enum ('active', 'inactive', 'archived') NOT NULL DEFAULT 'active', \`created_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \`updated_at\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), UNIQUE INDEX \`IDX_38b72100fbc5d6fcc98bd89c0b\` (\`keyword\`), PRIMARY KEY (\`id\`)) ENGINE=InnoDB`);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` DROP COLUMN \`source_page\``);
        await queryRunner.query(`ALTER TABLE \`keyword_analytics\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` ADD \`base_keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` ADD \`related_keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`search_trends\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`gender_search_ratios\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`monthly_search_ratios\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`weekday_search_ratios\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`intent_analysis\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`issue_analysis\` ADD \`keyword_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` ADD \`base_query_id\` int NOT NULL`);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` ADD \`collected_keyword_id\` int NOT NULL`);
        await queryRunner.query(`CREATE INDEX \`IDX_7ffbc168f0df1a1d522d5cdb42\` ON \`keyword_analytics\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_c4af49217b56cbf4f6d2b7316e\` ON \`keyword_analytics\` (\`keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_28360da9ce2c5a2fb5e60c3a05\` ON \`related_keywords\` (\`base_keyword_id\`, \`rank_position\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_c8b88890e2534edf77926ecdc7\` ON \`related_keywords\` (\`base_keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_151aa43697074e516a0d7ae4ab\` ON \`related_keywords\` (\`related_keyword_id\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_9f6f1cae53f5288c12d972cd79\` ON \`related_keywords\` (\`base_keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_77d232380113bec9c878d50b9b\` ON \`related_keywords\` (\`base_keyword_id\`, \`related_keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_b48a220593055cd1a5eeaf2023\` ON \`search_trends\` (\`keyword_id\`, \`period_type\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_16c248f55f8a5d2c2cc1e17939\` ON \`search_trends\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_0416e23ac44e08202a3f8d8af6\` ON \`search_trends\` (\`keyword_id\`, \`period_type\`, \`period_value\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_151dffc942faa56b8ba94ebd99\` ON \`gender_search_ratios\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_2d60a8a05c1d42543ed3ec1508\` ON \`gender_search_ratios\` (\`keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_1d5524432361035215908324b0\` ON \`monthly_search_ratios\` (\`keyword_id\`, \`analysis_year\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_c954aa4c6c6d0d7db245ce4c83\` ON \`monthly_search_ratios\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_791d1d6a478b43fc13f46ed9a4\` ON \`monthly_search_ratios\` (\`keyword_id\`, \`month_number\`, \`analysis_year\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_d4ad301d1a3e28b03dbe3f831d\` ON \`weekday_search_ratios\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_12f53dfd29908008ee73ad49df\` ON \`weekday_search_ratios\` (\`keyword_id\`, \`weekday_number\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_559fbfdb59f5d44189ce4321a4\` ON \`intent_analysis\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_bfd352917d6117fe322df1a753\` ON \`intent_analysis\` (\`keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_1fb0edee4b4cfa4a9ced503c2a\` ON \`issue_analysis\` (\`keyword_id\`)`);
        await queryRunner.query(`CREATE UNIQUE INDEX \`IDX_9a0e5e900fe6226c3394dac3fe\` ON \`issue_analysis\` (\`keyword_id\`, \`analysis_date\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_52bc48f21663daca9a4924f71b\` ON \`keyword_collection_logs\` (\`collected_keyword_id\`)`);
        await queryRunner.query(`CREATE INDEX \`IDX_b530e05c1e0173f988a4afb05a\` ON \`keyword_collection_logs\` (\`base_query_id\`)`);
        await queryRunner.query(`ALTER TABLE \`keyword_analytics\` ADD CONSTRAINT \`FK_7ffbc168f0df1a1d522d5cdb42a\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` ADD CONSTRAINT \`FK_9f6f1cae53f5288c12d972cd79d\` FOREIGN KEY (\`base_keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` ADD CONSTRAINT \`FK_151aa43697074e516a0d7ae4ab9\` FOREIGN KEY (\`related_keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`search_trends\` ADD CONSTRAINT \`FK_16c248f55f8a5d2c2cc1e17939a\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`gender_search_ratios\` ADD CONSTRAINT \`FK_151dffc942faa56b8ba94ebd990\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`monthly_search_ratios\` ADD CONSTRAINT \`FK_c954aa4c6c6d0d7db245ce4c839\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`weekday_search_ratios\` ADD CONSTRAINT \`FK_d4ad301d1a3e28b03dbe3f831d2\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`intent_analysis\` ADD CONSTRAINT \`FK_559fbfdb59f5d44189ce4321a4b\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`issue_analysis\` ADD CONSTRAINT \`FK_1fb0edee4b4cfa4a9ced503c2a7\` FOREIGN KEY (\`keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` ADD CONSTRAINT \`FK_b530e05c1e0173f988a4afb05aa\` FOREIGN KEY (\`base_query_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` ADD CONSTRAINT \`FK_52bc48f21663daca9a4924f71b4\` FOREIGN KEY (\`collected_keyword_id\`) REFERENCES \`keywords\`(\`id\`) ON DELETE CASCADE ON UPDATE NO ACTION`);
    }
    async down(queryRunner) {
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` DROP FOREIGN KEY \`FK_52bc48f21663daca9a4924f71b4\``);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` DROP FOREIGN KEY \`FK_b530e05c1e0173f988a4afb05aa\``);
        await queryRunner.query(`ALTER TABLE \`issue_analysis\` DROP FOREIGN KEY \`FK_1fb0edee4b4cfa4a9ced503c2a7\``);
        await queryRunner.query(`ALTER TABLE \`intent_analysis\` DROP FOREIGN KEY \`FK_559fbfdb59f5d44189ce4321a4b\``);
        await queryRunner.query(`ALTER TABLE \`weekday_search_ratios\` DROP FOREIGN KEY \`FK_d4ad301d1a3e28b03dbe3f831d2\``);
        await queryRunner.query(`ALTER TABLE \`monthly_search_ratios\` DROP FOREIGN KEY \`FK_c954aa4c6c6d0d7db245ce4c839\``);
        await queryRunner.query(`ALTER TABLE \`gender_search_ratios\` DROP FOREIGN KEY \`FK_151dffc942faa56b8ba94ebd990\``);
        await queryRunner.query(`ALTER TABLE \`search_trends\` DROP FOREIGN KEY \`FK_16c248f55f8a5d2c2cc1e17939a\``);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` DROP FOREIGN KEY \`FK_151aa43697074e516a0d7ae4ab9\``);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` DROP FOREIGN KEY \`FK_9f6f1cae53f5288c12d972cd79d\``);
        await queryRunner.query(`ALTER TABLE \`keyword_analytics\` DROP FOREIGN KEY \`FK_7ffbc168f0df1a1d522d5cdb42a\``);
        await queryRunner.query(`DROP INDEX \`IDX_b530e05c1e0173f988a4afb05a\` ON \`keyword_collection_logs\``);
        await queryRunner.query(`DROP INDEX \`IDX_52bc48f21663daca9a4924f71b\` ON \`keyword_collection_logs\``);
        await queryRunner.query(`DROP INDEX \`IDX_9a0e5e900fe6226c3394dac3fe\` ON \`issue_analysis\``);
        await queryRunner.query(`DROP INDEX \`IDX_1fb0edee4b4cfa4a9ced503c2a\` ON \`issue_analysis\``);
        await queryRunner.query(`DROP INDEX \`IDX_bfd352917d6117fe322df1a753\` ON \`intent_analysis\``);
        await queryRunner.query(`DROP INDEX \`IDX_559fbfdb59f5d44189ce4321a4\` ON \`intent_analysis\``);
        await queryRunner.query(`DROP INDEX \`IDX_12f53dfd29908008ee73ad49df\` ON \`weekday_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_d4ad301d1a3e28b03dbe3f831d\` ON \`weekday_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_791d1d6a478b43fc13f46ed9a4\` ON \`monthly_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_c954aa4c6c6d0d7db245ce4c83\` ON \`monthly_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_1d5524432361035215908324b0\` ON \`monthly_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_2d60a8a05c1d42543ed3ec1508\` ON \`gender_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_151dffc942faa56b8ba94ebd99\` ON \`gender_search_ratios\``);
        await queryRunner.query(`DROP INDEX \`IDX_0416e23ac44e08202a3f8d8af6\` ON \`search_trends\``);
        await queryRunner.query(`DROP INDEX \`IDX_16c248f55f8a5d2c2cc1e17939\` ON \`search_trends\``);
        await queryRunner.query(`DROP INDEX \`IDX_b48a220593055cd1a5eeaf2023\` ON \`search_trends\``);
        await queryRunner.query(`DROP INDEX \`IDX_77d232380113bec9c878d50b9b\` ON \`related_keywords\``);
        await queryRunner.query(`DROP INDEX \`IDX_9f6f1cae53f5288c12d972cd79\` ON \`related_keywords\``);
        await queryRunner.query(`DROP INDEX \`IDX_151aa43697074e516a0d7ae4ab\` ON \`related_keywords\``);
        await queryRunner.query(`DROP INDEX \`IDX_c8b88890e2534edf77926ecdc7\` ON \`related_keywords\``);
        await queryRunner.query(`DROP INDEX \`IDX_28360da9ce2c5a2fb5e60c3a05\` ON \`related_keywords\``);
        await queryRunner.query(`DROP INDEX \`IDX_c4af49217b56cbf4f6d2b7316e\` ON \`keyword_analytics\``);
        await queryRunner.query(`DROP INDEX \`IDX_7ffbc168f0df1a1d522d5cdb42\` ON \`keyword_analytics\``);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` DROP COLUMN \`collected_keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` DROP COLUMN \`base_query_id\``);
        await queryRunner.query(`ALTER TABLE \`issue_analysis\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`intent_analysis\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`weekday_search_ratios\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`monthly_search_ratios\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`gender_search_ratios\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`search_trends\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` DROP COLUMN \`related_keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`related_keywords\` DROP COLUMN \`base_keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`keyword_analytics\` DROP COLUMN \`keyword_id\``);
        await queryRunner.query(`ALTER TABLE \`keyword_collection_logs\` ADD \`source_page\` varchar(100) NOT NULL DEFAULT 'naver'`);
        await queryRunner.query(`DROP INDEX \`IDX_38b72100fbc5d6fcc98bd89c0b\` ON \`keywords\``);
        await queryRunner.query(`DROP TABLE \`keywords\``);
    }
}
exports.FixedDatabaseStructureImprovement1758510381678 = FixedDatabaseStructureImprovement1758510381678;
//# sourceMappingURL=1758510381678-FixedDatabaseStructureImprovement.js.map